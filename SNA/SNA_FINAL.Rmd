---
title: "Анализ сетевой структуры научных руководителей"
author: "Русских Данила, Кушниров Андрей"
date: "2023-12-22"
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: yes
  html_document:
    df_print: paged
header-includes:
- \usepackage{fontspec}
- \setmainfont{Times New Roman}
---
## 0. Описание данных

Открытая база данных всех выпускных квалификационных работ (ВКР) студентов НИУ ВШЭ позволила с лёгкостью собрать для дальнейшего анализа названия ВКР выпускников Факультета социальных наук за 2022 и 2023 годы, авторов работ, их научных руководителей и оценки за работы. Для этого на самом сайте были поставлены соответствующие фильтры, а потом с помощью библиотек beautifulsoup4 и requests был произведен парсинг данных с помощью цикла, который прошелся по всем станицам. К сожалению, не удалось имплементировать в изначальный цикл сбор данных за 2023 год, поэтому просто были созданы два соответствующих цикла для каждого года. Далее база данных за 2022 год была объединена с базой за 2023, в итоговом датасете собраны 289 строк, то есть ВКР с оценками. Было принято решение сохранить данные в формате csv для ускорения последующего анализа.
Итоговая база данных представляет собой csv-файл, где для каждой ВКР есть столбцы с названием работы, ФИО автора, полученной по выпуску ступенью образования (бакалавриат/магистратура), годом выпуска, оценкой и ФИО научного руководителя. Для последующего анализа из базы данных был сделан edge list, где каждая строка описывает отношение между студентом и научным руководителем, а также включает дополнительную информацию об оценке за выпускную работу: 

source: ФИО студента. Это поле представляет "источник" в отношении между студентом и научным руководителем. В контексте направленного графа, ребро исходит от студента.

target: ФИО научного руководителя. Это поле представляет "цель" или "пункт назначения" отношения. Ребро ведёт к научному руководителю.

weight: Оценка, которую студент получил за выпускную работу. Это поле может быть использовано для представления "веса" ребра в взвешенном графе, где вес может указывать на силу или важность отношения.

## 1. Исследовательская проблема, гипотезы и дизайн исследования

### Исследовательская проблема:
Выявление взаимосвязи между структурой сети научных руководителей и выпускников Факультета социальных наук НИУ ВШЭ за 2022-2023 годы и итоговой оценкой за ВКР, с акцентом на роль центральности научных руководителей и их влияние на распределение оценок среди студентов.

### Гипотезы:
**H1**: Студенты, научные руководители которых имеют высокую степень центральности в сети, склонны получать более высокие оценки за свои дипломные работы.

**H2**: Руководители с высокой межпосреднической центральностью оказывают более широкое влияние на итоговую оценку студентов, что потенциально может привести к более разнообразным оценкам за диплом.

**H3**: Научные руководители, работающие с большим количеством студентов, имеют более высокую степень входящих связей в сети. Это может влиять на структуру сети, увеличивая вероятность наличия связей между студентами этих научных руководителей.

### Дизайн Исследования:
Мы будем использовать методы анализа сетей для изучения структуры сети научных руководителей и студентов, рассчитаем различные меры центральности и проанализируем диадические и триадические отношения. Мы также будем использовать статистические модели для проверки гипотез, связанных с социальным отбором и влиянием.

## 2. Загрузка данных и визуализация

```{r}
#install.packages("igraph")
#install.packages("network")
#install.packages("sna")
#install.packages("ergm")

library(igraph)
library(network)
library(sna)
library(ergm)

edge_list <- read.csv("~/Desktop/NLP_SNA/SNA/edge_list.csv")

g <- igraph::graph_from_data_frame(edge_list, directed = TRUE)
E(g)$grades <- edge_list$weight

vertex_sizes <- igraph::degree(g) * 3 + 10

vertex_colors <- ifelse(igraph::V(g)$name %in% edge_list$source, "lightblue", "lightgreen")
edge_colors <- ifelse(igraph::E(g)$weight >= 4, "darkgreen", "red")

igraph::plot.igraph(g, 
     vertex.size = vertex_sizes, 
     vertex.color = vertex_colors, 
     edge.width = 2, # толщина рёбер
     edge.arrow.size = 0.2, # размер стрелок
     edge.color = edge_colors, 
     layout = igraph::layout_with_kk(g, maxiter = 5000), # увеличение расстояния между узлами
     main = "Визуализация сети выпускников ФСН НИУ ВШЭ 
     и их научных руководителей", 
     xlab = "", 
     ylab = "",
     vertex.label = NA, 
     edge.lty = 1,
     edge.arrow.mode = 0
)

legend("bottomleft",
       legend = c("Студенты", "Руководители"),
       fill = c("lightblue", "lightgreen")
)
```

## 3. Basic Measures: Network Statistics

```{r}
# Расчет плотности сети
network_density <- edge_density(g)

# Расчет средней длины пути
avg_path_length <- mean_distance(g, directed = TRUE)

cat("Плотность сети:", network_density, "\n")
cat("Средняя длина пути:", avg_path_length, "\n")
```

### Интерпретация результатов:
Плотность сети равна 0.00177895, что является довольно низким значением. Это означает, что в вашей сети очень мало рёбер по сравнению с максимально возможным количеством рёбер. В контексте сети научных руководителей и студентов это может означать, что большинство научных руководителей работают с одним или несколькими студентами.

Средняя длина пути в сети равна 8.532319. Это относительно большое значение, указывающее на то, что, в среднем, для перехода от одного узла сети к другому требуется много шагов. Это может быть связано с тем, что в сети много изолированных подгрупп или что существует несколько центральных узлов, через которые проходят большинство путей.


## 4. Меры центральности

```{r}
library(igraph)

in_degree_centrality <- igraph::degree(g, mode = "in")
out_degree_centrality <- igraph::degree(g, mode = "out")

in_closeness_centrality <- igraph::closeness(g, mode = "in")
out_closeness_centrality <- igraph::closeness(g, mode = "out")
betweenness_centrality <- igraph::betweenness(g)

V(g)$in_degree_centrality <- in_degree_centrality
V(g)$out_degree_centrality <- out_degree_centrality
V(g)$in_closeness_centrality <- in_closeness_centrality
V(g)$out_closeness_centrality <- out_closeness_centrality
V(g)$betweenness_centrality <- betweenness_centrality

cat("In-Degree Centrality:", in_degree_centrality, "\n")
cat("Out-Degree Centrality:", out_degree_centrality, "\n")
cat("In-Closeness Centrality:", in_closeness_centrality, "\n")
cat("Out-Closeness Centrality:", out_closeness_centrality, "\n")
cat("Betweenness Centrality:", betweenness_centrality, "\n")

```

Первым делом стоит обратить внимание на то, что многие узлы изолированы и поэтому имеют центральность 0.

### Интерпретация результатов:

1. **In-Degree Centrality**: Большинство узлов по это центральности имеют 0, что говорит об отсутствии у них связей от других узлов, при этом в сети есть несколько узлов с высоким значением этой центральности, что может указывать на наличие авторитетных узлов в сети.

2. **Out-Degree Centrality**: Большинство узлов по это центральности имеют 1, в то время как некоторые узлы не имеют исходящих связей (центральность равна 0). Это может указывать на то, что большинство узлов в сети активны в установлении связей с другими узлами, но в то же время есть узлы, которые полностью изолированы.

3. **In-Closeness Centrality**: Большинство узлов имеют очень низкое значение по этой центральности, что может означать, что эти узлы далеко расположены от других узлов в сети по числу шагов. Некоторые узлы имеют значение NaN, что может быть результатом того, что эти узлы полностью изолированы.

4. **Out-Closeness Centrality**: Результаты аналогичны In-Closeness Centrality, с тем исключением, что они относятся к исходящим связям.

5. **Betweenness Centrality**: Почти все узлы имеют степень посредничества равную 0, что говорит о том, что большинство узлов не действуют как "мосты" между другими узлами в сети. Это может быть признаком того, что сеть либо очень разрежена, либо состоит из нескольких изолированных подгрупп.

Таким образом, можно предположить, что сеть состоит из нескольких очень активных узлов (или "авторитетов"), в то время как большинство узлов либо изолированы, либо имеют очень низкую степень связности.

## 5. Dyadic & Triadic Analysis

```{r}

dyads <- t(combn(V(g), 2))

mutual_count <- 0
asymmetric_count <- 0
null_count <- 0

for (i in 1:nrow(dyads)) {
  node1 <- dyads[i, 1]
  node2 <- dyads[i, 2]
  
  edge1 <- get.edge.ids(g, c(node1, node2), directed = TRUE)
  edge2 <- get.edge.ids(g, c(node2, node1), directed = TRUE)
  
  if (length(edge1) > 0 & length(edge2) > 0) {
    mutual_count <- mutual_count + 1
  } else if (length(edge1) > 0 | length(edge2) > 0) {
    asymmetric_count <- asymmetric_count + 1
  } else {
    null_count <- null_count + 1
  }
}

cat("Mutual dyads:", mutual_count, "\n")
cat("Asymmetric dyads:", asymmetric_count, "\n")
cat("Null dyads:", null_count, "\n")

adj_matrix <- as.matrix(igraph::as_adjacency_matrix(g))
triads <- sna::triad.census(adj_matrix)
print(triads)
```

### Интерпретация результатов:
Как и ожидалось, все диады в сети является взаимными, что обусловленно структурой данных. Анализ триад дал следующие результаты:

1. Изолированные триады (9336875): Это число представляет собой количество триад, где нет связей между узлами. В контексте наших данных, это логично и ожидаемо, так как все работы писались индивидуально.

2. Односторонние триады (99761): Это ситуации, где один участник связан с другим, но отсутствует обратная связь, и третий участник остается изолированным. В контексте наших данных, это также логично и ожидаемо, так как все работы писались индивидуально.

3. Триады типа 021D (3) и 021U (481): 021D может представлять собой ситуацию, где один научный руководитель работает с двумя студентами, в то время как 030T может представлять собой ситуацию, где трое студентов работают с одним и тем же научным руководителем.

## 6. Ideas about the Strenght of a Weak Ties and Structural Holes (in your
network)

В рамках данной сети слабые связи могут оказаться важными для научных руководителей, так как они позволяют им расширять область своих научных интересов засчет помощи студентам в рамках написаниями ими ВКР. В текущей структуре сети существует много структурных дыр, это может являться и препятствиям, и возможностью. С одной стороны, это может затруднять быстрый обмен информацией и ресурсами, с другой стороны, это предоставляет возможности для инноваций и творческого обмена, поскольку идеи не застревают в "эхо-камерах" тесно связанных групп.

## 7. Проверка гипотез

**H1**: Студенты, научные руководители которых имеют высокую степень центральности в сети, склонны получать более высокие оценки за свои дипломные работы.

```{r}
from_vertices <- igraph::tail_of(g, E(g))
to_vertices <- igraph::head_of(g, E(g))

data <- data.frame(
  grades = E(g)$grades,
  from_centrality = V(g)$in_degree_centrality[from_vertices],
  to_centrality = V(g)$in_degree_centrality[to_vertices]
)

model1 <- lm(grades ~ to_centrality, data = data)
summary(model1)
length(unique(data$to_centrality))
```
### Интерпретация результатов:

Существует положительная статистически значимая взаимосвязь между центральностью научных руководителей и оценками дипломных работ, но модель объясняет примерно 12% вариации в оценках. Несмотря на статистическую значимость, влияние центральности на оценки не очень велико, так как коэффициент при to_centrality довольно мал. Учитывая, что уникальных значений центральности всего 10, это может указывать на наличие определенных групп руководителей с различным уровнем влияния на оценки. Гипотеза подтверждается.

**H2**: Руководители с высокой межпосреднической центральностью оказывают более широкое влияние на итоговую оценку студентов, что потенциально может привести к более разнообразным оценкам за диплом.

```{r}
from_vertices <- igraph::tail_of(g, E(g))
to_vertices <- igraph::head_of(g, E(g))

data <- data.frame(
  grades = E(g)$grades,
  betweenness_centrality = V(g)$betweenness_centrality[from_vertices]
)

model1 <- lm(grades ~ betweenness_centrality, data = data)
summary(model1)
length(unique(data$betweenness_centrality))
```
### Интерпретация результатов:
Так как межпосредническая центральность одинакова для всех наблюдений (количество уникальных значений межпосреднической центральности равно 1), она не изменяется среди научных руководителей, и, следовательно, невозможно оценить её влияние на оценки дипломных работ. 

**H3**: Научные руководители, работающие с большим количеством студентов, имеют более высокую степень входящих связей в сети. Это может влиять на структуру сети, увеличивая вероятность наличия связей между студентами этих научных руководителей.

```{r}
library(ergm)

V(g)$in_degree_centrality <- in_degree_centrality

median_in_degree <- median(in_degree_centrality)
V(g)$influential <- ifelse(V(g)$in_degree_centrality > median_in_degree, 1, 0)

net <- network::as.network.matrix(as.matrix(g), directed = TRUE)

set.vertex.attribute(net, "influential", V(g)$influential)

ergm_model <- ergm(net ~ edges + nodecov("influential"))
summary(ergm_model)

```

### Интерпретация результатов:

Коэффициент для рёбер (edges) равен -6.94, что указывает на общую тенденцию к отсутствию связей в сети. Это значение значимо отличается от нуля (p < 0.001), что означает, что в сети меньше связей, чем можно было бы ожидать случайным образом, сеть является разряженной.

Коэффициент для влиятельности узлов (атрибут influential) равен 0.75, что указывает на то, что узлы, обозначенные как влиятельные, имеют тенденцию иметь больше связей. Это значение также значимо отличается от нуля (p < 0.001), что подтверждает вашу гипотезу о том, что влиятельные узлы играют важную роль в сети. Таким образом, научные руководители с высокой степенью входящих связей (обозначенные как влиятельные) имеют тенденцию к увеличению числа своих связей,они становятся ещё более центральными в сети, что может указывать на наличие положительной обратной связи, где более "популярные" руководители привлекают ещё больше студентов.

Итак, исходя из предложенной гипотезы, наши результаты подтверждают предположение о том, что научные руководители, взаимодействующие с большим числом студентов, занимают ключевую позицию в структуре сети. Это обстоятельство может привести к формированию более тесно связанных подгрупп в рамках сети, при этом студенты, находящиеся под руководством этих влиятельных наставников, скорее всего, будут взаимосвязаны между собой. Также возможны разнообразные социальные и академические эффекты, характер которых будет зависеть от конкретного контекста исследования, к ним относятся распространение информации, создание академических коллективов и возможности для совместной работы.

## 8. Заключение

В рамках нашего исследования мы погрузились в анализ сети выпускников Факультета социальных наук НИУ ВШЭ и их научных руководителей. И вот что нам удалось выяснить:

**Гипотеза 1 (H1)**: Мы предположили, что оценки за дипломные работы студентов будут выше, если их научные руководители занимают центральное положение в сети. И, оказывается, мы были правы! Существует заметная связь между центральностью руководителя и оценками выпускников. Но стоит отметить, что модель объясняет только 12% разницы в оценках, так что, вероятно, есть и другие факторы, которые стоит учитывать.

**Гипотеза 2 (H2)**: Мы также рассматривали возможность того, что руководители с высоким уровнем межпосреднической центральности могут оказывать более разнообразное влияние на итоговые оценки студентов. Однако, к сожалению, все участники сети оказались на одном уровне межпосреднической центральности, и мы не смогли проверить эту гипотезу.

**Гипотеза 3 (H3)**: Ну и наконец, мы предположили, что руководители, которые работают с большим количеством студентов, занимают более важное место в сети. И это подтвердилось! Эти "влиятельные" руководители действительно играют ключевую роль, укрепляя связи между студентами и способствуя формированию более плотной и взаимосвязанной структуры сети.

Таким образом, наше исследование позволило нам лучше понять, как устроена сеть взаимоотношений между студентами и их руководителями на ФСН НИУ ВШЭ. Мы выявили некоторые ключевые тенденции и паттерны, хотя для более глубокого анализа и понимания всех аспектов этой сети потребуются дополнительные исследования.